# Agent Workflow Documentation

This document describes the AI Agent workflow used to generate weekly content for the CNCF Landscape A-to-Z website.

## Overview

The content generation is powered by a **Prefect** flow located in `src/agentic/flow.py`. It orchestrates multiple AI agents to research, write, and publish blog posts.

## Architecture

The workflow consists of the following components:

### 1. Agents (`src/agentic/agents/`)
- **Editor Agent** (`editor.py`): Decides which letter/week to process next.
- **Researcher Agent** (`researcher.py`): Researches specific CNCF projects using web search and documentation.
- **Writer Agent** (`writer.py`): Synthesizes research into a blog post.

### 2. Models (`src/agentic/models.py`)
- Defines Pydantic models for data exchange between agents (e.g., `ResearchOutput`, `BlogPostDraft`).

### 3. Workflow Logic (`src/agentic/flow.py`)
The `weekly_content_flow` executes the following steps:
1.  **`determine_next_week`**: Asks the Editor Agent for the next letter to process (A-Z).
2.  **`get_items_for_week`**: Retrieves the list of projects for that letter (from `data/` generated by the ETL pipeline or raw CNCF data).
3.  **`research_item`**: For each project, runs the Researcher Agent to gather key features, updates, and summaries. This runs in parallel.
4.  **`write_weekly_post`**: Passes the aggregated research to the Writer Agent to create a blog post draft.
5.  **`save_post`**: Saves the generated markdown content to `website/content/posts/YYYY-[Letter].md`.

## Updating the Workflow

### Modifying Agent Behavior
To change how agents perform their tasks (e.g., to adjust the tone of the blog post or the depth of research):
1.  Navigate to `src/agentic/agents/`.
2.  Edit the system prompts in the respective agent file (`researcher.py`, `writer.py`, etc.).

### Supporting the New UI (Structured Data)
The new website UI features a "Tools" grid that requires structured data (e.g., status, description, stars, category) rather than just a Markdown blob.
To support this:
1.  Update `src/agentic/models.py` to include a structured list of tools in `BlogPostDraft`.
2.  Update the **Writer Agent** prompt in `src/agentic/agents/writer.py` to output this structured data in the Front Matter of the markdown file or as a separate JSON/YAML file.
3.  Update `save_post` in `src/agentic/flow.py` to write this data correctly.

### Running the Workflow Locally
To run the agent workflow:
```bash
# Set up environment variables (LLM API keys, Logfire token if used)
export GOOGLE_API_KEY=your_key_here
export LOGFIRE_TOKEN=your_token_here # Optional

# Run the CLI command
python src/cli.py run workflow --limit 1
```

## Troubleshooting
- **Logs**: execution logs are handled by `logfire` and Prefect. Check the console output or the Prefect UI.
- **Missing Data**: If `data/week_*` folders are missing, the flow falls back to fetching raw data from the CNCF repository. Ensure internet access is available.
