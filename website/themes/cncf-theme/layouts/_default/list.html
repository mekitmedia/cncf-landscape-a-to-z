{{ define "main" }}
{{ $current := partial "get-current-week.html" . }}
<div class="min-h-screen bg-slate-50 font-sans text-slate-900">
    <!-- Navigation Header -->
    {{ partial "nav.html" . }}

    <main id="main-content" tabindex="-1" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Progress Tracker -->
        {{ partial "progress.html" (dict "context" . "current" $current) }}

        <!-- Hero Section -->
        {{ partial "hero.html" (dict "context" . "current" $current) }}

        <!-- Tools Section -->
        {{ partial "tools-grid.html" (dict "context" . "current" $current) }}

        <!-- Recent Blog Posts -->
        {{ partial "recent-posts.html" . }}

        <!-- Navigation Footer -->
        {{ partial "homepage-footer.html" (dict "context" . "current" $current) }}
    </main>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const countdownEl = document.getElementById('countdown');
        
        // Calculate total seconds until next rotation (every 2 weeks)
        const now = new Date();
        const startOfYear = new Date(now.getFullYear(), 0, 1);
        const dayOfYear = Math.floor((now - startOfYear) / (1000 * 60 * 60 * 24)) + 1;
        const weekNum = Math.floor((dayOfYear + 6) / 7);
        const twoWeekPeriod = Math.floor((weekNum - 1) / 2);
        const nextRotationWeek = (twoWeekPeriod + 1) * 2 + 1;
        const nextRotationDate = new Date(now.getFullYear(), 0, 1 + (nextRotationWeek - 1) * 7);
        
        let totalSeconds = Math.max(0, Math.floor((nextRotationDate - now) / 1000));

        function updateCountdown() {
             if(totalSeconds > 0) {
                totalSeconds--;
                const d = Math.floor(totalSeconds / (24 * 3600));
                const h = Math.floor((totalSeconds % (24 * 3600)) / 3600);
                const m = Math.floor((totalSeconds % 3600) / 60);
                const s = totalSeconds % 60;
                if (countdownEl) {
                    countdownEl.textContent = `${d}d ${h}h ${m}m ${s}s`;
                }
             } else {
                if (countdownEl) {
                    countdownEl.textContent = "Rotating...";
                }
             }
        }
        
        setInterval(updateCountdown, 1000);
        updateCountdown();

    });
</script>
{{ end }}
