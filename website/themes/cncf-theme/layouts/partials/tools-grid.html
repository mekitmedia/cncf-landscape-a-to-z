{{ $current := .current }}
{{ $context := .context }}
{{ $dataKey := "00-A" }}
{{ if $context }}
    {{ $dataKey = $context.Params.data_key | default "00-A" }}
{{ end }}
{{ if $current }}
    {{ $dataKey = $current.dataKey }}
{{ end }}
{{ $normalizedKey := $dataKey }}
{{ if hasPrefix $dataKey "week_" }}
    {{ $normalizedKey = replaceRE "^week_(\\d{2})_([A-Z])$" "$1-$2" $dataKey }}
{{ end }}
{{ $site := .Site }}
{{ if .context }}
    {{ $site = .context.Site }}
{{ end }}
{{ $weeksData := index $site.Data "weeks" }}
{{ $weekData := index $weeksData $normalizedKey }}
{{ $categoriesData := dict }}
{{ if $weekData }}
    {{ $categoriesData = index $weekData "categories" }}
{{ end }}

<div class="flex items-center justify-between mb-8">
    <div>
        <h2 class="text-2xl font-bold text-slate-900">Featured '<span id="current-letter-featured">{{ if $current }}{{ $current.letter }}{{ else if $context }}{{ $context.Params.letter | default "A" }}{{ else }}A{{ end }}</span>' Tools</h2>
        <p class="text-slate-500">Hand-picked highlights from the CNCF registry.</p>
    </div>
    <div class="flex gap-2">
        <button class="p-2 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 shadow-sm"><i data-lucide="search" class="w-5 h-5"></i></button>
        <button class="p-2 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 shadow-sm"><i data-lucide="layout-grid" class="w-5 h-5"></i></button>
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="tools-grid">
{{ if $weekData }}
    {{ $featured := slice }}
    {{ range $filename, $items := $categoriesData }}
        {{ range $items }}
            {{ if .featured }}
                {{ $featured = $featured | append (dict "item" . "category" $filename) }}
            {{ end }}
        {{ end }}
    {{ end }}
    {{ range first 6 $featured }}
        {{ $item := .item }}
        {{ $category := .category }}
        <div class="bg-white p-6 rounded-2xl border border-slate-200 hover:border-blue-400 hover:shadow-xl hover:shadow-blue-50 transition-all group">
            <div class="flex justify-between items-start mb-4">
                {{ if $item.project }}
                {{ $projectClass := "bg-gray-100 text-gray-700" }}
                {{ if eq (lower $item.project) "graduated" }}
                    {{ $projectClass = "bg-green-100 text-green-700" }}
                {{ else if eq (lower $item.project) "incubating" }}
                    {{ $projectClass = "bg-blue-100 text-blue-700" }}
                {{ end }}
                <div class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-tighter {{ $projectClass }}">{{ $item.project }}</div>
                {{ end }}
                <button class="text-slate-300 hover:text-amber-400 transition-colors"><i data-lucide="star" class="w-4.5 h-4.5"></i></button>
            </div>
            <h4 class="text-xl font-bold mb-2 group-hover:text-blue-600 transition-colors">{{ $item.name }}</h4>
            <p class="text-sm text-slate-500 mb-6 min-h-[40px] leading-relaxed line-clamp-3">{{ $item.description }}</p>
            <div class="flex items-center justify-between pt-4 border-t border-slate-100 text-xs font-medium text-slate-400">
                 <span class="flex items-center gap-1 uppercase tracking-tighter truncate max-w-[150px]">{{ $category | replaceRE "_" " " | humanize }}</span>
                <div class="flex gap-2">
                    {{ if $item.homepage_url }}
                    <a href="{{ $item.homepage_url }}" target="_blank" class="flex items-center gap-1 hover:text-blue-600"><i data-lucide="external-link" class="w-3 h-3"></i></a>
                    {{ end }}
                </div>
            </div>
        </div>
    {{ end }}
{{ else }}
   <div class="col-span-3 text-center text-slate-500">
       <p>No data available for {{ $normalizedKey }}.</p>
   </div>
{{ end }}
</div>
